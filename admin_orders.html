<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f8f9fa; }
        .container { max-width: 1200px; margin-top: 30px; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .table-card { background: #fff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .table th { background-color: #1e1e1e; color: #fff; font-weight: 500; text-align: center; white-space: nowrap; }
        .table td { vertical-align: middle; }
        
        /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        .col-items { white-space: pre-line; font-size: 0.9rem; color: #555; min-width: 250px; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏•‡∏î */
        .loading { text-align: center; padding: 50px; color: #888; }
        
        /* ‡∏õ‡∏∏‡πà‡∏° Refresh */
        .btn-refresh { background-color: #00d2ff; border: none; font-weight: bold; color: #000; }
        .btn-refresh:hover { background-color: #00a0c2; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-bar">
            <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ (Admin)</h3>
            <div>
                <a href="index.html" class="btn btn-outline-secondary me-2">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <button class="btn btn-refresh" onclick="fetchOrders()">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>

        <div class="table-card">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                            <th style="text-align: left;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</th>
                            <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        </tbody>
                </table>
            </div>
            <div id="loadingMsg" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
        
        <div class="text-muted mt-3 text-end" style="font-size: 0.8rem;">
            * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î -> ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î
        </div>
    </div>

    <script>
        // ******************************************************
        // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        // ******************************************************
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzkOehJBDiiH7UwsMw1PpRCd__mZxVMQPrpswaEKKM6HLUe4AObXshAOCeQWDBrHJnEAQ/exec';

        function fetchOrders() {
            const tableBody = document.getElementById('orderTableBody');
            const loadingMsg = document.getElementById('loadingMsg');
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á Loading
            tableBody.innerHTML = '';
            loadingMsg.style.display = 'block';

            // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á get_all ‡πÑ‡∏õ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify({ action: 'get_all' })
            })
            .then(response => response.json())
            .then(response => {
                loadingMsg.style.display = 'none';

                if (response.status === 'success') {
                    const orders = response.data;
                    
                    if (orders.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö</td></tr>';
                        return;
                    }

                    let html = '';
                    orders.forEach(order => {
                        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏ï‡∏±‡∏î ' ‡∏≠‡∏≠‡∏Å ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                        let phone = order.phone.replace("'", "");
                        
                        html += `
                        <tr>
                            <td class="text-center text-muted" style="font-size: 0.85rem;">${order.date}</td>
                            <td class="fw-bold text-primary">${order.name}</td>
                            <td class="text-center"><a href="tel:${phone}" style="text-decoration:none; color:#333;">${phone}</a></td>
                            <td class="col-items">${order.items}</td>
                            <td class="text-center fw-bold text-danger">${parseInt(order.total).toLocaleString()} ‡∏ø</td>
                            <td class="text-muted" style="font-size: 0.85rem;">${order.note || '-'}</td>
                        </tr>`;
                    });
                    
                    tableBody.innerHTML = html;
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + response.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                loadingMsg.innerText = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = fetchOrders;
    </script>

</body>

</html>
